{"ast":null,"code":"import _regeneratorRuntime from\"/Users/adamvanbuskirk/Sites/btrpolymers/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/adamvanbuskirk/Sites/btrpolymers/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axios from'axios';import{store}from'../Core/store';//import { logout, setAccessToken } from '../Store/Auth';\nexport var axiosPublic=axios.create({baseURL:process.env.REACT_APP_BACKEND_URL});export var axiosPrivate=axios.create({baseURL:process.env.REACT_APP_BACKEND_URL,headers:{'Content-Type':'application/json'},withCredentials:true});export var responseInterceptPublic=axiosPublic.interceptors.response.use(function(response){return response;},/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(error){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",Promise.reject({\"message\":error.response.data.message}));case 1:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());export var requestIntercept=axiosPrivate.interceptors.request.use(function(config){if(!config.headers['Authorization']){config.headers['Authorization']=\"Bearer \".concat(store.getState().user.accessToken);}return config;},function(error){return Promise.reject(error);});export var responseIntercept=axiosPrivate.interceptors.response.use(function(response){return response;},/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(error){var _error$response;var prevRequest,newAccessToken;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:prevRequest=error===null||error===void 0?void 0:error.config;if(!((error===null||error===void 0?void 0:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===403&&!(prevRequest!==null&&prevRequest!==void 0&&prevRequest.sent))){_context2.next=8;break;}prevRequest.sent=true;_context2.next=5;return axiosPublic.get('/api/auth/refresh',{withCredentials:true}).then(function(res){//store.dispatch(setAccessToken(res.data.accessToken));\nreturn res.data.accessToken;}).catch(function(error){/* refresh failed w/ 403, log user out */ //store.dispatch(logout());\n});case 5:newAccessToken=_context2.sent;prevRequest.headers['Authorization']=\"Bearer \".concat(newAccessToken);return _context2.abrupt(\"return\",axiosPrivate(prevRequest));case 8:return _context2.abrupt(\"return\",Promise.reject({\"message\":error.response.data.message}));case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}());","map":{"version":3,"names":["axios","store","axiosPublic","create","baseURL","process","env","REACT_APP_BACKEND_URL","axiosPrivate","headers","withCredentials","responseInterceptPublic","interceptors","response","use","error","Promise","reject","data","message","requestIntercept","request","config","getState","user","accessToken","responseIntercept","prevRequest","status","sent","get","then","res","catch","newAccessToken"],"sources":["/Users/adamvanbuskirk/Sites/btrpolymers/client/src/Core/axios.js"],"sourcesContent":["import axios from 'axios';\nimport { store } from '../Core/store';\n//import { logout, setAccessToken } from '../Store/Auth';\n\nexport const axiosPublic = axios.create({\n    baseURL: process.env.REACT_APP_BACKEND_URL\n});\n\nexport const axiosPrivate = axios.create({\n    baseURL: process.env.REACT_APP_BACKEND_URL,\n    headers: { 'Content-Type': 'application/json' },\n    withCredentials: true\n});\n\nexport const responseInterceptPublic = axiosPublic.interceptors.response.use(\n    response => response,\n    async (error) => {\n        return Promise.reject({\n            \"message\": error.response.data.message\n        });\n    }\n);\n\nexport const requestIntercept = axiosPrivate.interceptors.request.use(\n    config => {\n        if (!config.headers['Authorization']) {\n            config.headers['Authorization'] = `Bearer ${store.getState().user.accessToken}`;\n        }\n        return config;\n    }, (error) => Promise.reject(error)\n);\n\nexport const responseIntercept = axiosPrivate.interceptors.response.use(\n    response => response,\n    async (error) => {\n        const prevRequest = error?.config;\n        if (error?.response?.status === 403 && !prevRequest?.sent) {\n            prevRequest.sent = true;\n            const newAccessToken = await axiosPublic.get('/api/auth/refresh', { \n                withCredentials: true \n            }).then((res) => {\n                //store.dispatch(setAccessToken(res.data.accessToken));\n                return res.data.accessToken;\n            }).catch((error) => {\n                /* refresh failed w/ 403, log user out */\n                //store.dispatch(logout());\n            });\n            prevRequest.headers['Authorization'] = `Bearer ${newAccessToken}`;\n            return axiosPrivate(prevRequest);\n        } \n        return Promise.reject({\n            \"message\": error.response.data.message\n        });\n    }\n);"],"mappings":"wRAAA,MAAOA,MAAP,KAAkB,OAAlB,CACA,OAASC,KAAT,KAAsB,eAAtB,CACA;AAEA,MAAO,IAAMC,YAAW,CAAGF,KAAK,CAACG,MAAN,CAAa,CACpCC,OAAO,CAAEC,OAAO,CAACC,GAAR,CAAYC,qBADe,CAAb,CAApB,CAIP,MAAO,IAAMC,aAAY,CAAGR,KAAK,CAACG,MAAN,CAAa,CACrCC,OAAO,CAAEC,OAAO,CAACC,GAAR,CAAYC,qBADgB,CAErCE,OAAO,CAAE,CAAE,eAAgB,kBAAlB,CAF4B,CAGrCC,eAAe,CAAE,IAHoB,CAAb,CAArB,CAMP,MAAO,IAAMC,wBAAuB,CAAGT,WAAW,CAACU,YAAZ,CAAyBC,QAAzB,CAAkCC,GAAlC,CACnC,SAAAD,QAAQ,QAAIA,SAAJ,EAD2B,4FAEnC,iBAAOE,KAAP,oJACWC,OAAO,CAACC,MAAR,CAAe,CAClB,UAAWF,KAAK,CAACF,QAAN,CAAeK,IAAf,CAAoBC,OADb,CAAf,CADX,wDAFmC,+DAAhC,CASP,MAAO,IAAMC,iBAAgB,CAAGZ,YAAY,CAACI,YAAb,CAA0BS,OAA1B,CAAkCP,GAAlC,CAC5B,SAAAQ,MAAM,CAAI,CACN,GAAI,CAACA,MAAM,CAACb,OAAP,CAAe,eAAf,CAAL,CAAsC,CAClCa,MAAM,CAACb,OAAP,CAAe,eAAf,mBAA4CR,KAAK,CAACsB,QAAN,GAAiBC,IAAjB,CAAsBC,WAAlE,EACH,CACD,MAAOH,OAAP,CACH,CAN2B,CAMzB,SAACP,KAAD,QAAWC,QAAO,CAACC,MAAR,CAAeF,KAAf,CAAX,EANyB,CAAzB,CASP,MAAO,IAAMW,kBAAiB,CAAGlB,YAAY,CAACI,YAAb,CAA0BC,QAA1B,CAAmCC,GAAnC,CAC7B,SAAAD,QAAQ,QAAIA,SAAJ,EADqB,6FAE7B,kBAAOE,KAAP,2KACUY,WADV,CACwBZ,KADxB,SACwBA,KADxB,iBACwBA,KAAK,CAAEO,MAD/B,MAEQ,CAAAP,KAAK,OAAL,EAAAA,KAAK,SAAL,yBAAAA,KAAK,CAAEF,QAAP,0DAAiBe,MAAjB,IAA4B,GAA5B,EAAmC,EAACD,WAAD,SAACA,WAAD,WAACA,WAAW,CAAEE,IAAd,CAF3C,2BAGQF,WAAW,CAACE,IAAZ,CAAmB,IAAnB,CAHR,uBAIqC3B,YAAW,CAAC4B,GAAZ,CAAgB,mBAAhB,CAAqC,CAC9DpB,eAAe,CAAE,IAD6C,CAArC,EAE1BqB,IAF0B,CAErB,SAACC,GAAD,CAAS,CACb;AACA,MAAOA,IAAG,CAACd,IAAJ,CAASO,WAAhB,CACH,CAL4B,EAK1BQ,KAL0B,CAKpB,SAAClB,KAAD,CAAW,CAChB,yCADgB,CAEhB;AACH,CAR4B,CAJrC,QAIcmB,cAJd,gBAaQP,WAAW,CAAClB,OAAZ,CAAoB,eAApB,mBAAiDyB,cAAjD,EAbR,iCAce1B,YAAY,CAACmB,WAAD,CAd3B,0CAgBWX,OAAO,CAACC,MAAR,CAAe,CAClB,UAAWF,KAAK,CAACF,QAAN,CAAeK,IAAf,CAAoBC,OADb,CAAf,CAhBX,0DAF6B,iEAA1B"},"metadata":{},"sourceType":"module"}