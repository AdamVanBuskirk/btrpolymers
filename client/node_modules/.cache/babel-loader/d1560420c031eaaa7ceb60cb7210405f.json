{"ast":null,"code":"import _toConsumableArray from\"/Users/adamvanbuskirk/Sites/btrpolymers/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"/Users/adamvanbuskirk/Sites/btrpolymers/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/adamvanbuskirk/Sites/btrpolymers/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";// Store/ReportSubscriptions.ts\nimport{createAsyncThunk,createSlice}from\"@reduxjs/toolkit\";import{axiosPrivate}from\"../Core/axios\";var initialState={byReportType:{},activeSubscription:null,status:\"unset\",errorMessage:\"\",createStatus:\"unset\",updateStatus:\"unset\",toggleStatus:\"unset\",runNowStatus:\"unset\"};// -----------------------------\n// Thunks (API calls)\n// -----------------------------\nexport var deleteSubscription=createAsyncThunk(\"reportSubscriptions/delete\",/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(args,_ref){var rejectWithValue,_e$response,_e$response$data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:rejectWithValue=_ref.rejectWithValue;_context.prev=1;_context.next=4;return axiosPrivate.delete(\"api/report/company/\".concat(args.companyId,\"/subscriptions/\").concat(args.id));case 4:return _context.abrupt(\"return\",{id:args.id,reportType:args.reportType});case 7:_context.prev=7;_context.t0=_context[\"catch\"](1);return _context.abrupt(\"return\",rejectWithValue((_context.t0===null||_context.t0===void 0?void 0:(_e$response=_context.t0.response)===null||_e$response===void 0?void 0:(_e$response$data=_e$response.data)===null||_e$response$data===void 0?void 0:_e$response$data.message)||\"Failed to delete subscription.\"));case 10:case\"end\":return _context.stop();}}},_callee,null,[[1,7]]);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}());export var createSubscription=createAsyncThunk(\"reportSubscriptions/create\",/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(args){var res;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axiosPrivate.post(\"api/report/subscriptions\",args,{headers:{\"Content-Type\":\"application/json\"},withCredentials:true});case 2:res=_context2.sent;return _context2.abrupt(\"return\",res.data);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x3){return _ref3.apply(this,arguments);};}());export var updateSubscription=createAsyncThunk(\"reportSubscriptions/update\",/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(args){var res;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axiosPrivate.put(\"api/report/subscriptions/\".concat(args.id),args.patch,{headers:{\"Content-Type\":\"application/json\"},withCredentials:true});case 2:res=_context3.sent;return _context3.abrupt(\"return\",res.data);case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x4){return _ref4.apply(this,arguments);};}());export var enableSubscription=createAsyncThunk(\"reportSubscriptions/enable\",/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(args){var res;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return axiosPrivate.post(\"api/report/subscriptions/\".concat(args.id,\"/enable\"),{},{headers:{\"Content-Type\":\"application/json\"},withCredentials:true});case 2:res=_context4.sent;return _context4.abrupt(\"return\",res.data);case 4:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x5){return _ref5.apply(this,arguments);};}());export var disableSubscription=createAsyncThunk(\"reportSubscriptions/disable\",/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(args){var res;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return axiosPrivate.post(\"api/report/subscriptions/\".concat(args.id,\"/disable\"),{},{headers:{\"Content-Type\":\"application/json\"},withCredentials:true});case 2:res=_context5.sent;return _context5.abrupt(\"return\",res.data);case 4:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x6){return _ref6.apply(this,arguments);};}());export var runNowSubscription=createAsyncThunk(\"reportSubscriptions/runNow\",/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(args){var res;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return axiosPrivate.post(\"api/report/subscriptions/\".concat(args.id,\"/run-now\"),{},{headers:{\"Content-Type\":\"application/json\"},withCredentials:true});case 2:res=_context6.sent;return _context6.abrupt(\"return\",res.data);case 4:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x7){return _ref7.apply(this,arguments);};}());export var getSubscriptionsByReportType=createAsyncThunk(\"reportSubscriptions/getByReportType\",/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(args){var res;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return axiosPrivate.get(\"api/report/company/\".concat(args.companyId,\"/subscriptions/\").concat(args.reportType),{headers:{\"Content-Type\":\"application/json\"},withCredentials:true});case 2:res=_context7.sent;return _context7.abrupt(\"return\",{reportType:args.reportType,items:res.data});case 4:case\"end\":return _context7.stop();}}},_callee7);}));return function(_x8){return _ref8.apply(this,arguments);};}());// -----------------------------\n// Helpers (state updates)\n// -----------------------------\nfunction upsertIntoList(list,sub){var idx=list.findIndex(function(x){return String(x._id)===String(sub._id);});if(idx>=0){var next=_toConsumableArray(list);next[idx]=sub;return next;}return[sub].concat(_toConsumableArray(list));}function removeFromList(list,id){return list.filter(function(x){return String(x._id)!==String(id);});}// -----------------------------\n// Slice\n// -----------------------------\nexport var ReportSubscriptionsSlice=createSlice({name:\"reportSubscriptions\",initialState:initialState,reducers:{clearReportSubscriptionsError:function clearReportSubscriptionsError(state){state.errorMessage=\"\";},setActiveSubscription:function setActiveSubscription(state,action){state.activeSubscription=action.payload;},// handy for optimistic UI if you want later\nremoveSubscriptionLocally:function removeSubscriptionLocally(state,action){var _action$payload=action.payload,reportType=_action$payload.reportType,id=_action$payload.id;state.byReportType[reportType]=removeFromList(state.byReportType[reportType]||[],id);}},extraReducers:function extraReducers(builder){// -----------------------------\n// getSubscriptionsByReportType\n// -----------------------------\nbuilder.addCase(getSubscriptionsByReportType.pending,function(state){state.status=\"loading\";state.errorMessage=\"\";}).addCase(getSubscriptionsByReportType.rejected,function(state,action){state.status=\"failed\";state.errorMessage=action.error.message||\"Failed to load subscriptions.\";}).addCase(getSubscriptionsByReportType.fulfilled,function(state,action){state.status=\"idle\";state.byReportType[action.payload.reportType]=action.payload.items||[];});// -----------------------------\n// createSubscription\n// -----------------------------\nbuilder.addCase(createSubscription.pending,function(state){state.createStatus=\"loading\";state.errorMessage=\"\";}).addCase(createSubscription.rejected,function(state,action){state.createStatus=\"failed\";state.errorMessage=action.error.message||\"Failed to create subscription.\";}).addCase(createSubscription.fulfilled,function(state,action){state.createStatus=\"idle\";var sub=action.payload;var rt=sub.reportType;state.byReportType[rt]=upsertIntoList(state.byReportType[rt]||[],sub);state.activeSubscription=sub;});// -----------------------------\n// updateSubscription\n// -----------------------------\nbuilder.addCase(deleteSubscription.pending,function(state){state.toggleStatus=\"loading\";// or add deleteStatus if you want\nstate.errorMessage=\"\";}).addCase(deleteSubscription.rejected,function(state,action){state.toggleStatus=\"failed\";state.errorMessage=action.payload||action.error.message||\"Failed to delete subscription.\";}).addCase(deleteSubscription.fulfilled,function(state,action){var _state$activeSubscrip;state.toggleStatus=\"idle\";var _action$payload2=action.payload,id=_action$payload2.id,reportType=_action$payload2.reportType;state.byReportType[reportType]=removeFromList(state.byReportType[reportType]||[],id);if(((_state$activeSubscrip=state.activeSubscription)===null||_state$activeSubscrip===void 0?void 0:_state$activeSubscrip._id)===id){state.activeSubscription=null;}}).addCase(updateSubscription.pending,function(state){state.updateStatus=\"loading\";state.errorMessage=\"\";}).addCase(updateSubscription.rejected,function(state,action){state.updateStatus=\"failed\";state.errorMessage=action.error.message||\"Failed to update subscription.\";}).addCase(updateSubscription.fulfilled,function(state,action){state.updateStatus=\"idle\";var sub=action.payload;var rt=sub.reportType;state.byReportType[rt]=upsertIntoList(state.byReportType[rt]||[],sub);state.activeSubscription=sub;});// -----------------------------\n// enable/disable\n// -----------------------------\nbuilder.addCase(enableSubscription.pending,function(state){state.toggleStatus=\"loading\";state.errorMessage=\"\";}).addCase(disableSubscription.pending,function(state){state.toggleStatus=\"loading\";state.errorMessage=\"\";}).addCase(enableSubscription.rejected,function(state,action){state.toggleStatus=\"failed\";state.errorMessage=action.error.message||\"Failed to enable subscription.\";}).addCase(disableSubscription.rejected,function(state,action){state.toggleStatus=\"failed\";state.errorMessage=action.error.message||\"Failed to disable subscription.\";}).addCase(enableSubscription.fulfilled,function(state,action){state.toggleStatus=\"idle\";var sub=action.payload;var rt=sub.reportType;state.byReportType[rt]=upsertIntoList(state.byReportType[rt]||[],sub);state.activeSubscription=sub;}).addCase(disableSubscription.fulfilled,function(state,action){state.toggleStatus=\"idle\";var sub=action.payload;var rt=sub.reportType;state.byReportType[rt]=upsertIntoList(state.byReportType[rt]||[],sub);state.activeSubscription=sub;});// -----------------------------\n// runNowSubscription\n// -----------------------------\nbuilder.addCase(runNowSubscription.pending,function(state){state.runNowStatus=\"loading\";state.errorMessage=\"\";}).addCase(runNowSubscription.rejected,function(state,action){state.runNowStatus=\"failed\";state.errorMessage=action.error.message||\"Failed to run report now.\";}).addCase(runNowSubscription.fulfilled,function(state,action){state.runNowStatus=\"idle\";var sub=action.payload;var rt=sub.reportType;state.byReportType[rt]=upsertIntoList(state.byReportType[rt]||[],sub);state.activeSubscription=sub;});}});var _ReportSubscriptionsS=ReportSubscriptionsSlice.actions,clearReportSubscriptionsError=_ReportSubscriptionsS.clearReportSubscriptionsError,setActiveSubscription=_ReportSubscriptionsS.setActiveSubscription,removeSubscriptionLocally=_ReportSubscriptionsS.removeSubscriptionLocally;export{clearReportSubscriptionsError,setActiveSubscription,removeSubscriptionLocally};export var getReportSubscriptions=function getReportSubscriptions(state){return state.reportSubscriptions;};export default ReportSubscriptionsSlice.reducer;","map":{"version":3,"names":["createAsyncThunk","createSlice","axiosPrivate","initialState","byReportType","activeSubscription","status","errorMessage","createStatus","updateStatus","toggleStatus","runNowStatus","deleteSubscription","args","rejectWithValue","delete","companyId","id","reportType","response","data","message","createSubscription","post","headers","withCredentials","res","updateSubscription","put","patch","enableSubscription","disableSubscription","runNowSubscription","getSubscriptionsByReportType","get","items","upsertIntoList","list","sub","idx","findIndex","x","String","_id","next","removeFromList","filter","ReportSubscriptionsSlice","name","reducers","clearReportSubscriptionsError","state","setActiveSubscription","action","payload","removeSubscriptionLocally","extraReducers","builder","addCase","pending","rejected","error","fulfilled","rt","actions","getReportSubscriptions","reportSubscriptions","reducer"],"sources":["/Users/adamvanbuskirk/Sites/btrpolymers/client/src/Store/ReportSubscriptions.ts"],"sourcesContent":["// Store/ReportSubscriptions.ts\nimport { createAsyncThunk, createSlice, PayloadAction } from \"@reduxjs/toolkit\";\nimport { RootState } from \"../Core/store\";\nimport { axiosPrivate } from \"../Core/axios\";\nimport { companyStatus } from \"../Helpers/types\";\n\n// -----------------------------\n// Types\n// -----------------------------\nexport type ReportType = \"actions_leaderboard\" | \"leadership_dashboard\"; // add more as needed\n\nexport type Recipient =\n  | { type: \"email\"; email: string }\n  | { type: \"user\"; userId: string };\n\nexport type Schedule = {\n  frequency: \"daily\" | \"weekly\" | \"monthly\";\n  timeOfDay: string; // \"HH:mm\"\n  timezone: string; // IANA\n  daysOfWeek?: number[]; // 0-6 Sun-Sat\n  dayOfMonth?: number; // 1-31\n};\n\nexport type Delivery = {\n  //format: \"email_html\" | \"pdf\" | \"both\";\n  format: \"email_html\" | \"pdf\" | \"both\" | \"csv\" | \"email_csv\";\n  subject: string;\n  message?: string;\n};\n\nexport type ReportSubscriptionDto = {\n  _id: string;\n  companyId: string;\n\n  name: string;\n  reportType: ReportType;\n\n  // report-specific config (you decide structure per report)\n  reportConfig: any;\n\n  recipients: Recipient[];\n  timezone: string;\n  schedule: Schedule;\n  delivery: Delivery;\n\n  isEnabled: boolean;\n\n  lastRunAt?: string | Date;\n  lastStatus?: \"success\" | \"error\" | \"unset\";\n  lastError?: string;\n\n  created?: string | Date;\n  modified?: string | Date;\n};\n\nexport type CreateSubscriptionArgs = {\n  companyId: string;\n  name: string;\n  reportType: ReportType;\n  reportConfig: any;\n  recipients: Recipient[];\n  schedule: Schedule;\n  delivery: Delivery;\n  isEnabled?: boolean;\n};\n\nexport type UpdateSubscriptionArgs = {\n  id: string;\n  patch: Partial<{\n    name: string;\n    reportConfig: any;\n    recipients: Recipient[];\n    schedule: Schedule;\n    delivery: Delivery;\n    isEnabled: boolean;\n  }>;\n};\n\n// -----------------------------\n// State\n// -----------------------------\nexport interface ReportSubscriptionsState {\n  byReportType: Record<string, ReportSubscriptionDto[]>;\n  activeSubscription?: ReportSubscriptionDto | null;\n\n  status: companyStatus; // loading/failed/idle/unset\n  errorMessage: string;\n\n  // optional: more granular statuses for UX\n  createStatus: companyStatus;\n  updateStatus: companyStatus;\n  toggleStatus: companyStatus;\n  runNowStatus: companyStatus;\n}\n\nconst initialState: ReportSubscriptionsState = {\n  byReportType: {},\n  activeSubscription: null,\n\n  status: \"unset\",\n  errorMessage: \"\",\n\n  createStatus: \"unset\",\n  updateStatus: \"unset\",\n  toggleStatus: \"unset\",\n  runNowStatus: \"unset\",\n};\n\n\n\n// -----------------------------\n// Thunks (API calls)\n// -----------------------------\n\n\nexport const deleteSubscription = createAsyncThunk(\n  \"reportSubscriptions/delete\",\n  async (args: { id: string; companyId: string; reportType: ReportType }, { rejectWithValue }) => {\n    try {\n      await axiosPrivate.delete(`api/report/company/${args.companyId}/subscriptions/${args.id}`);\n      return { id: args.id, reportType: args.reportType };\n    } catch (e: any) {\n      return rejectWithValue(e?.response?.data?.message || \"Failed to delete subscription.\");\n    }\n  }\n);\n\n\n\n\nexport const createSubscription = createAsyncThunk(\n  \"reportSubscriptions/create\",\n  async (args: CreateSubscriptionArgs) => {\n    const res = await axiosPrivate.post(\n      \"api/report/subscriptions\",\n      args,\n      { headers: { \"Content-Type\": \"application/json\" }, withCredentials: true }\n    );\n    return res.data as ReportSubscriptionDto;\n  }\n);\n\nexport const updateSubscription = createAsyncThunk(\n  \"reportSubscriptions/update\",\n  async (args: UpdateSubscriptionArgs) => {\n    const res = await axiosPrivate.put(\n      `api/report/subscriptions/${args.id}`,\n      args.patch,\n      { headers: { \"Content-Type\": \"application/json\" }, withCredentials: true }\n    );\n    return res.data as ReportSubscriptionDto;\n  }\n);\n\nexport const enableSubscription = createAsyncThunk(\n  \"reportSubscriptions/enable\",\n  async (args: { id: string }) => {\n    const res = await axiosPrivate.post(\n      `api/report/subscriptions/${args.id}/enable`,\n      {},\n      { headers: { \"Content-Type\": \"application/json\" }, withCredentials: true }\n    );\n    return res.data as ReportSubscriptionDto;\n  }\n);\n\nexport const disableSubscription = createAsyncThunk(\n  \"reportSubscriptions/disable\",\n  async (args: { id: string }) => {\n    const res = await axiosPrivate.post(\n      `api/report/subscriptions/${args.id}/disable`,\n      {},\n      { headers: { \"Content-Type\": \"application/json\" }, withCredentials: true }\n    );\n    return res.data as ReportSubscriptionDto;\n  }\n);\n\nexport const runNowSubscription = createAsyncThunk(\n  \"reportSubscriptions/runNow\",\n  async (args: { id: string }) => {\n    const res = await axiosPrivate.post(\n      `api/report/subscriptions/${args.id}/run-now`,\n      {},\n      { headers: { \"Content-Type\": \"application/json\" }, withCredentials: true }\n    );\n    // backend can return updated sub or just { ok: true }; weâ€™ll assume updated sub\n    return res.data as ReportSubscriptionDto;\n  }\n);\n\nexport const getSubscriptionsByReportType = createAsyncThunk(\n  \"reportSubscriptions/getByReportType\",\n  async (args: { companyId: string; reportType: ReportType }) => {\n    const res = await axiosPrivate.get(\n      `api/report/company/${args.companyId}/subscriptions/${args.reportType}`,\n      { headers: { \"Content-Type\": \"application/json\" }, withCredentials: true }\n    );\n\n    return { reportType: args.reportType, items: res.data as ReportSubscriptionDto[] };\n  }\n);\n\n// -----------------------------\n// Helpers (state updates)\n// -----------------------------\nfunction upsertIntoList(list: ReportSubscriptionDto[], sub: ReportSubscriptionDto) {\n  const idx = list.findIndex((x) => String(x._id) === String(sub._id));\n  if (idx >= 0) {\n    const next = [...list];\n    next[idx] = sub;\n    return next;\n  }\n  return [sub, ...list];\n}\n\nfunction removeFromList(list: ReportSubscriptionDto[], id: string) {\n  return list.filter((x) => String(x._id) !== String(id));\n}\n\n// -----------------------------\n// Slice\n// -----------------------------\nexport const ReportSubscriptionsSlice = createSlice({\n  name: \"reportSubscriptions\",\n  initialState,\n  reducers: {\n    clearReportSubscriptionsError(state) {\n      state.errorMessage = \"\";\n    },\n    setActiveSubscription(state, action: PayloadAction<ReportSubscriptionDto | null>) {\n      state.activeSubscription = action.payload;\n    },\n\n    // handy for optimistic UI if you want later\n    removeSubscriptionLocally(\n      state,\n      action: PayloadAction<{ reportType: ReportType; id: string }>\n    ) {\n      const { reportType, id } = action.payload;\n      state.byReportType[reportType] = removeFromList(state.byReportType[reportType] || [], id);\n    },\n  },\n  extraReducers: (builder) => {\n    // -----------------------------\n    // getSubscriptionsByReportType\n    // -----------------------------\n    builder\n      .addCase(getSubscriptionsByReportType.pending, (state) => {\n        state.status = \"loading\";\n        state.errorMessage = \"\";\n      })\n      .addCase(getSubscriptionsByReportType.rejected, (state, action) => {\n        state.status = \"failed\";\n        state.errorMessage = (action.error.message as string) || \"Failed to load subscriptions.\";\n      })\n      .addCase(getSubscriptionsByReportType.fulfilled, (state, action) => {\n        state.status = \"idle\";\n        state.byReportType[action.payload.reportType] = action.payload.items || [];\n      });\n\n    // -----------------------------\n    // createSubscription\n    // -----------------------------\n    builder\n      .addCase(createSubscription.pending, (state) => {\n        state.createStatus = \"loading\";\n        state.errorMessage = \"\";\n      })\n      .addCase(createSubscription.rejected, (state, action) => {\n        state.createStatus = \"failed\";\n        state.errorMessage = (action.error.message as string) || \"Failed to create subscription.\";\n      })\n      .addCase(createSubscription.fulfilled, (state, action) => {\n        state.createStatus = \"idle\";\n        const sub = action.payload;\n        const rt = sub.reportType;\n        state.byReportType[rt] = upsertIntoList(state.byReportType[rt] || [], sub);\n        state.activeSubscription = sub;\n      });\n\n    // -----------------------------\n    // updateSubscription\n    // -----------------------------\n    builder\n      .addCase(deleteSubscription.pending, (state) => {\n        state.toggleStatus = \"loading\"; // or add deleteStatus if you want\n        state.errorMessage = \"\";\n      })\n      .addCase(deleteSubscription.rejected, (state, action) => {\n        state.toggleStatus = \"failed\";\n        state.errorMessage =\n          (action.payload as string) ||\n          (action.error.message as string) ||\n          \"Failed to delete subscription.\";\n      })\n      .addCase(deleteSubscription.fulfilled, (state, action) => {\n        state.toggleStatus = \"idle\";\n        const { id, reportType } = action.payload;\n    \n        state.byReportType[reportType] = removeFromList(state.byReportType[reportType] || [], id);\n    \n        if (state.activeSubscription?._id === id) {\n          state.activeSubscription = null;\n        }\n      })\n      .addCase(updateSubscription.pending, (state) => {\n        state.updateStatus = \"loading\";\n        state.errorMessage = \"\";\n      })\n      .addCase(updateSubscription.rejected, (state, action) => {\n        state.updateStatus = \"failed\";\n        state.errorMessage = (action.error.message as string) || \"Failed to update subscription.\";\n      })\n      .addCase(updateSubscription.fulfilled, (state, action) => {\n        state.updateStatus = \"idle\";\n        const sub = action.payload;\n        const rt = sub.reportType;\n        state.byReportType[rt] = upsertIntoList(state.byReportType[rt] || [], sub);\n        state.activeSubscription = sub;\n      });\n\n    // -----------------------------\n    // enable/disable\n    // -----------------------------\n    builder\n      .addCase(enableSubscription.pending, (state) => {\n        state.toggleStatus = \"loading\";\n        state.errorMessage = \"\";\n      })\n      .addCase(disableSubscription.pending, (state) => {\n        state.toggleStatus = \"loading\";\n        state.errorMessage = \"\";\n      })\n      .addCase(enableSubscription.rejected, (state, action) => {\n        state.toggleStatus = \"failed\";\n        state.errorMessage = (action.error.message as string) || \"Failed to enable subscription.\";\n      })\n      .addCase(disableSubscription.rejected, (state, action) => {\n        state.toggleStatus = \"failed\";\n        state.errorMessage = (action.error.message as string) || \"Failed to disable subscription.\";\n      })\n      .addCase(enableSubscription.fulfilled, (state, action) => {\n        state.toggleStatus = \"idle\";\n        const sub = action.payload;\n        const rt = sub.reportType;\n        state.byReportType[rt] = upsertIntoList(state.byReportType[rt] || [], sub);\n        state.activeSubscription = sub;\n      })\n      .addCase(disableSubscription.fulfilled, (state, action) => {\n        state.toggleStatus = \"idle\";\n        const sub = action.payload;\n        const rt = sub.reportType;\n        state.byReportType[rt] = upsertIntoList(state.byReportType[rt] || [], sub);\n        state.activeSubscription = sub;\n      });\n\n    // -----------------------------\n    // runNowSubscription\n    // -----------------------------\n    builder\n      .addCase(runNowSubscription.pending, (state) => {\n        state.runNowStatus = \"loading\";\n        state.errorMessage = \"\";\n      })\n      .addCase(runNowSubscription.rejected, (state, action) => {\n        state.runNowStatus = \"failed\";\n        state.errorMessage = (action.error.message as string) || \"Failed to run report now.\";\n      })\n      .addCase(runNowSubscription.fulfilled, (state, action) => {\n        state.runNowStatus = \"idle\";\n        const sub = action.payload;\n        const rt = sub.reportType;\n        state.byReportType[rt] = upsertIntoList(state.byReportType[rt] || [], sub);\n        state.activeSubscription = sub;\n      });\n  },\n});\n\nexport const {\n  clearReportSubscriptionsError,\n  setActiveSubscription,\n  removeSubscriptionLocally,\n} = ReportSubscriptionsSlice.actions;\n\nexport const getReportSubscriptions = (state: RootState) => state.reportSubscriptions;\n\nexport default ReportSubscriptionsSlice.reducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}