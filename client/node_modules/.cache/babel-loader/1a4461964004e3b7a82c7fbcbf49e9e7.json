{"ast":null,"code":"import axios from 'axios';\nimport { store } from '../Core/store'; //import { logout, setAccessToken } from '../Store/Auth';\n\nexport const axiosPublic = axios.create({\n  baseURL: process.env.REACT_APP_BACKEND_URL\n});\nexport const axiosPrivate = axios.create({\n  baseURL: process.env.REACT_APP_BACKEND_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  withCredentials: true\n});\nexport const responseInterceptPublic = axiosPublic.interceptors.response.use(response => response, async error => {\n  return Promise.reject({\n    \"message\": error.response.data.message\n  });\n});\nexport const requestIntercept = axiosPrivate.interceptors.request.use(config => {\n  if (!config.headers['Authorization']) {\n    config.headers['Authorization'] = `Bearer ${store.getState().user.accessToken}`;\n  }\n\n  return config;\n}, error => Promise.reject(error));\nexport const responseIntercept = axiosPrivate.interceptors.response.use(response => response, async error => {\n  var _error$response;\n\n  const prevRequest = error === null || error === void 0 ? void 0 : error.config;\n\n  if ((error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 403 && !(prevRequest !== null && prevRequest !== void 0 && prevRequest.sent)) {\n    prevRequest.sent = true;\n    const newAccessToken = await axiosPublic.get('/api/auth/refresh', {\n      withCredentials: true\n    }).then(res => {\n      //store.dispatch(setAccessToken(res.data.accessToken));\n      return res.data.accessToken;\n    }).catch(error => {\n      /* refresh failed w/ 403, log user out */\n      //store.dispatch(logout());\n    });\n    prevRequest.headers['Authorization'] = `Bearer ${newAccessToken}`;\n    return axiosPrivate(prevRequest);\n  }\n\n  return Promise.reject({\n    \"message\": error.response.data.message\n  });\n});","map":{"version":3,"names":["axios","store","axiosPublic","create","baseURL","process","env","REACT_APP_BACKEND_URL","axiosPrivate","headers","withCredentials","responseInterceptPublic","interceptors","response","use","error","Promise","reject","data","message","requestIntercept","request","config","getState","user","accessToken","responseIntercept","prevRequest","status","sent","newAccessToken","get","then","res","catch"],"sources":["/Users/adamvanbuskirk/Sites/btrpolymers/client/src/Core/axios.js"],"sourcesContent":["import axios from 'axios';\nimport { store } from '../Core/store';\n//import { logout, setAccessToken } from '../Store/Auth';\n\nexport const axiosPublic = axios.create({\n    baseURL: process.env.REACT_APP_BACKEND_URL\n});\n\nexport const axiosPrivate = axios.create({\n    baseURL: process.env.REACT_APP_BACKEND_URL,\n    headers: { 'Content-Type': 'application/json' },\n    withCredentials: true\n});\n\nexport const responseInterceptPublic = axiosPublic.interceptors.response.use(\n    response => response,\n    async (error) => {\n        return Promise.reject({\n            \"message\": error.response.data.message\n        });\n    }\n);\n\nexport const requestIntercept = axiosPrivate.interceptors.request.use(\n    config => {\n        if (!config.headers['Authorization']) {\n            config.headers['Authorization'] = `Bearer ${store.getState().user.accessToken}`;\n        }\n        return config;\n    }, (error) => Promise.reject(error)\n);\n\nexport const responseIntercept = axiosPrivate.interceptors.response.use(\n    response => response,\n    async (error) => {\n        const prevRequest = error?.config;\n        if (error?.response?.status === 403 && !prevRequest?.sent) {\n            prevRequest.sent = true;\n            const newAccessToken = await axiosPublic.get('/api/auth/refresh', { \n                withCredentials: true \n            }).then((res) => {\n                //store.dispatch(setAccessToken(res.data.accessToken));\n                return res.data.accessToken;\n            }).catch((error) => {\n                /* refresh failed w/ 403, log user out */\n                //store.dispatch(logout());\n            });\n            prevRequest.headers['Authorization'] = `Bearer ${newAccessToken}`;\n            return axiosPrivate(prevRequest);\n        } \n        return Promise.reject({\n            \"message\": error.response.data.message\n        });\n    }\n);"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,KAAT,QAAsB,eAAtB,C,CACA;;AAEA,OAAO,MAAMC,WAAW,GAAGF,KAAK,CAACG,MAAN,CAAa;EACpCC,OAAO,EAAEC,OAAO,CAACC,GAAR,CAAYC;AADe,CAAb,CAApB;AAIP,OAAO,MAAMC,YAAY,GAAGR,KAAK,CAACG,MAAN,CAAa;EACrCC,OAAO,EAAEC,OAAO,CAACC,GAAR,CAAYC,qBADgB;EAErCE,OAAO,EAAE;IAAE,gBAAgB;EAAlB,CAF4B;EAGrCC,eAAe,EAAE;AAHoB,CAAb,CAArB;AAMP,OAAO,MAAMC,uBAAuB,GAAGT,WAAW,CAACU,YAAZ,CAAyBC,QAAzB,CAAkCC,GAAlC,CACnCD,QAAQ,IAAIA,QADuB,EAEnC,MAAOE,KAAP,IAAiB;EACb,OAAOC,OAAO,CAACC,MAAR,CAAe;IAClB,WAAWF,KAAK,CAACF,QAAN,CAAeK,IAAf,CAAoBC;EADb,CAAf,CAAP;AAGH,CANkC,CAAhC;AASP,OAAO,MAAMC,gBAAgB,GAAGZ,YAAY,CAACI,YAAb,CAA0BS,OAA1B,CAAkCP,GAAlC,CAC5BQ,MAAM,IAAI;EACN,IAAI,CAACA,MAAM,CAACb,OAAP,CAAe,eAAf,CAAL,EAAsC;IAClCa,MAAM,CAACb,OAAP,CAAe,eAAf,IAAmC,UAASR,KAAK,CAACsB,QAAN,GAAiBC,IAAjB,CAAsBC,WAAY,EAA9E;EACH;;EACD,OAAOH,MAAP;AACH,CAN2B,EAMxBP,KAAD,IAAWC,OAAO,CAACC,MAAR,CAAeF,KAAf,CANc,CAAzB;AASP,OAAO,MAAMW,iBAAiB,GAAGlB,YAAY,CAACI,YAAb,CAA0BC,QAA1B,CAAmCC,GAAnC,CAC7BD,QAAQ,IAAIA,QADiB,EAE7B,MAAOE,KAAP,IAAiB;EAAA;;EACb,MAAMY,WAAW,GAAGZ,KAAH,aAAGA,KAAH,uBAAGA,KAAK,CAAEO,MAA3B;;EACA,IAAI,CAAAP,KAAK,SAAL,IAAAA,KAAK,WAAL,+BAAAA,KAAK,CAAEF,QAAP,oEAAiBe,MAAjB,MAA4B,GAA5B,IAAmC,EAACD,WAAD,aAACA,WAAD,eAACA,WAAW,CAAEE,IAAd,CAAvC,EAA2D;IACvDF,WAAW,CAACE,IAAZ,GAAmB,IAAnB;IACA,MAAMC,cAAc,GAAG,MAAM5B,WAAW,CAAC6B,GAAZ,CAAgB,mBAAhB,EAAqC;MAC9DrB,eAAe,EAAE;IAD6C,CAArC,EAE1BsB,IAF0B,CAEpBC,GAAD,IAAS;MACb;MACA,OAAOA,GAAG,CAACf,IAAJ,CAASO,WAAhB;IACH,CAL4B,EAK1BS,KAL0B,CAKnBnB,KAAD,IAAW;MAChB;MACA;IACH,CAR4B,CAA7B;IASAY,WAAW,CAAClB,OAAZ,CAAoB,eAApB,IAAwC,UAASqB,cAAe,EAAhE;IACA,OAAOtB,YAAY,CAACmB,WAAD,CAAnB;EACH;;EACD,OAAOX,OAAO,CAACC,MAAR,CAAe;IAClB,WAAWF,KAAK,CAACF,QAAN,CAAeK,IAAf,CAAoBC;EADb,CAAf,CAAP;AAGH,CArB4B,CAA1B"},"metadata":{},"sourceType":"module"}