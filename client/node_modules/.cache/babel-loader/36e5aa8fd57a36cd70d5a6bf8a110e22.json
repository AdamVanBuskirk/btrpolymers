{"ast":null,"code":"import _regeneratorRuntime from\"/Users/adamvanbuskirk/Sites/btrpolymers/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/adamvanbuskirk/Sites/btrpolymers/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{createAsyncThunk,createSlice}from'@reduxjs/toolkit';import{axiosPrivate,axiosPublic}from'../Core/axios';var initialState={plans:[],status:\"unset\",errorMessage:\"\",mostRecentPayment:null,clientSecret:\"\"};export var getPlans=createAsyncThunk('api/stripe/get/plans',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axiosPublic.get('api/stripe',{headers:{'Content-Type':'application/json'},withCredentials:true}).then(function(res){return res.data;});case 2:return _context.abrupt(\"return\",_context.sent);case 3:case\"end\":return _context.stop();}}},_callee);})));export var getMostRecentPayment=createAsyncThunk('api/stripe/get/recent/payment',/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(companyId){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axiosPrivate.get('api/stripe/recent/payment/'+companyId,{headers:{'Content-Type':'application/json'},withCredentials:true}).then(function(res){return res.data;});case 2:return _context2.abrupt(\"return\",_context2.sent);case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}());export var deleteMostRecentPayment=createAsyncThunk('api/stripe/delete/recent/payment',/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(params){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axiosPrivate.delete(\"api/stripe/recent/payment/\".concat(params.companyId,\"/\").concat(params._id),{headers:{'Content-Type':'application/json'},withCredentials:true}).then(function(res){return res.data;});case 2:return _context3.abrupt(\"return\",_context3.sent);case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x2){return _ref3.apply(this,arguments);};}());export var createSubscription=createAsyncThunk('api/stripe/create/subscription',/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(params){return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return axiosPrivate.post('api/stripe/create/subscription',JSON.stringify(params),{headers:{'Content-Type':'application/json'},withCredentials:true}).then(function(res){return res.data;});case 2:return _context4.abrupt(\"return\",_context4.sent);case 3:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x3){return _ref4.apply(this,arguments);};}());export var cancelSubscription=createAsyncThunk('api/stripe/cancel/subscription',/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(params){return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return axiosPrivate.post('api/stripe/cancel/subscription',JSON.stringify(params),{headers:{'Content-Type':'application/json'},withCredentials:true}).then(function(res){return res.data;});case 2:return _context5.abrupt(\"return\",_context5.sent);case 3:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x4){return _ref5.apply(this,arguments);};}());export var createSetupIntent=createAsyncThunk('api/stripe/create-setup-intent',/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(params){return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return axiosPrivate.post('api/stripe/create-setup-intent',JSON.stringify(params),{headers:{'Content-Type':'application/json'},withCredentials:true}).then(function(res){return res.data;});case 2:return _context6.abrupt(\"return\",_context6.sent);case 3:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x5){return _ref6.apply(this,arguments);};}());export var setDefaultPayment=createAsyncThunk('api/stripe/set-default-payment',/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(params){return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return axiosPrivate.post('api/stripe/set-default-payment',JSON.stringify(params),{headers:{'Content-Type':'application/json'},withCredentials:true}).then(function(res){return res.data;});case 2:return _context7.abrupt(\"return\",_context7.sent);case 3:case\"end\":return _context7.stop();}}},_callee7);}));return function(_x6){return _ref7.apply(this,arguments);};}());export var setStripeStatus=createAsyncThunk('set/stripe/status',/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(status){return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:return _context8.abrupt(\"return\",status);case 1:case\"end\":return _context8.stop();}}},_callee8);}));return function(_x7){return _ref8.apply(this,arguments);};}());export var StripeSlice=createSlice({name:'strip',initialState:initialState,reducers:{},extraReducers:function extraReducers(builder){builder.addCase(setStripeStatus.fulfilled,function(state,action){state.status=action.payload;}).addCase(deleteMostRecentPayment.fulfilled,function(state,action){state.status='idle';state.mostRecentPayment=action.payload;}).addCase(getMostRecentPayment.rejected,function(state,action){state.status='idle';state.mostRecentPayment=null;}).addCase(getMostRecentPayment.fulfilled,function(state,action){state.status='idle';state.mostRecentPayment=action.payload;}).addCase(getPlans.fulfilled,function(state,action){state.status='idle';state.plans=action.payload;}).addCase(createSubscription.fulfilled,function(state,action){state.status='idle';state.mostRecentPayment=action.payload.payment;state.clientSecret=action.payload.clientSecret;}).addCase(createSetupIntent.fulfilled,function(state,action){state.status='idle';state.clientSecret=action.payload.clientSecret;}).addCase(cancelSubscription.fulfilled,function(state,action){state.status='subscriptionCanceled';state.mostRecentPayment=action.payload;});}});export var getStripe=function getStripe(state){return state.stripe;};export default StripeSlice.reducer;","map":{"version":3,"names":["createAsyncThunk","createSlice","axiosPrivate","axiosPublic","initialState","plans","status","errorMessage","mostRecentPayment","clientSecret","getPlans","get","headers","withCredentials","then","res","data","getMostRecentPayment","companyId","deleteMostRecentPayment","params","delete","_id","createSubscription","post","JSON","stringify","cancelSubscription","createSetupIntent","setDefaultPayment","setStripeStatus","StripeSlice","name","reducers","extraReducers","builder","addCase","fulfilled","state","action","payload","rejected","payment","getStripe","stripe","reducer"],"sources":["/Users/adamvanbuskirk/Sites/btrpolymers/client/src/Store/Stripe.ts"],"sourcesContent":["import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport { RootState } from '../Core/store';\nimport { axiosPrivate, axiosPublic } from '../Core/axios';\nimport { stripeStatus } from '../Helpers/types';\nimport { StripePlan } from '../Models/Requests/StripePlan';\nimport { StripePayment } from '../Models/Requests/StripePayment';\n\nexport interface StripeState {\n  plans: Array<StripePlan>;\n  status: stripeStatus;\n  errorMessage: string;\n  mostRecentPayment: StripePayment | null;\n  clientSecret: string;\n}\n\nconst initialState: StripeState = {\n  plans: [],\n  status: \"unset\",\n  errorMessage: \"\",\n  mostRecentPayment: null,\n  clientSecret: \"\"\n\n};\n\nexport const getPlans = createAsyncThunk(\n  'api/stripe/get/plans',\n  async () => {    \n    return await axiosPublic.get('api/stripe',\n      {\n        headers: { 'Content-Type': 'application/json' },\n        withCredentials: true\n      }\n    ).then(\n      (res) => {\n        return res.data;\n      }\n    );\n});\n\nexport const getMostRecentPayment = createAsyncThunk(\n  'api/stripe/get/recent/payment',\n  async (companyId: string) => {\n    return await axiosPrivate.get('api/stripe/recent/payment/' + companyId,\n      {\n        headers: { 'Content-Type': 'application/json' },\n        withCredentials: true \n      }\n    ).then(res => res.data);\n});\n\nexport const deleteMostRecentPayment = createAsyncThunk(\n  'api/stripe/delete/recent/payment',\n  async (params: { companyId: string, _id: string }) => {    \n    return await axiosPrivate.delete(`api/stripe/recent/payment/${params.companyId}/${params._id}`,\n      {\n          headers: { 'Content-Type': 'application/json' },\n          withCredentials: true\n      }\n    ).then(\n      (res) => {\n          return res.data;\n      }\n    );\n});\n\nexport const createSubscription = createAsyncThunk(\n  'api/stripe/create/subscription',\n  async (params: { companyId: string, priceId: string, qty: number }) => {    \n      return await axiosPrivate.post('api/stripe/create/subscription',\n          JSON.stringify(params),\n          {\n              headers: { 'Content-Type': 'application/json' },\n              withCredentials: true\n          }\n      ).then(\n          (res) => {\n              return res.data;\n          }\n      );\n});\n\nexport const cancelSubscription = createAsyncThunk(\n  'api/stripe/cancel/subscription',\n  async (params: { companyId: string, subscriptionId: string}) => {    \n      return await axiosPrivate.post('api/stripe/cancel/subscription',\n          JSON.stringify(params),\n          {\n              headers: { 'Content-Type': 'application/json' },\n              withCredentials: true\n          }\n      ).then(\n          (res) => {\n              return res.data;\n          }\n      );\n});\n\nexport const createSetupIntent = createAsyncThunk(\n  'api/stripe/create-setup-intent',\n  async (params: { companyId: string }) => {    \n    return await axiosPrivate.post('api/stripe/create-setup-intent',\n      JSON.stringify(params),\n      {\n        headers: { 'Content-Type': 'application/json' },\n        withCredentials: true\n      }\n    ).then(\n      (res) => {\n        return res.data;\n      }\n    );\n});\n\nexport const setDefaultPayment = createAsyncThunk(\n  'api/stripe/set-default-payment',\n  async (params: { companyId: string, customerId: string, subscriptionId: string, paymentMethodId: string }) => {    \n    return await axiosPrivate.post('api/stripe/set-default-payment',\n      JSON.stringify(params),\n      {\n        headers: { 'Content-Type': 'application/json' },\n        withCredentials: true\n      }\n    ).then(\n      (res) => {\n        return res.data;\n      }\n    );\n});\n\nexport const setStripeStatus = createAsyncThunk(\n  'set/stripe/status',\n  async (status: stripeStatus) => {    \n      return status;\n});\n\nexport const StripeSlice = createSlice({\n  name: 'strip',\n  initialState,\n  reducers: {\n  },\n  extraReducers: (builder) => {\n    builder\n      .addCase(setStripeStatus.fulfilled, (state, action) => {\n        state.status = action.payload;\n      })\n      .addCase(deleteMostRecentPayment.fulfilled, (state, action) => {\n        state.status = 'idle';\n        state.mostRecentPayment = action.payload;\n      })\n      .addCase(getMostRecentPayment.rejected, (state, action) => {\n        state.status = 'idle';\n        state.mostRecentPayment = null;\n      })\n      .addCase(getMostRecentPayment.fulfilled, (state, action) => {\n        state.status = 'idle';\n        state.mostRecentPayment = action.payload;\n      })\n      .addCase(getPlans.fulfilled, (state, action) => {\n        state.status = 'idle';\n        state.plans = action.payload;\n      })\n      .addCase(createSubscription.fulfilled, (state, action) => {\n        state.status = 'idle';\n        state.mostRecentPayment = action.payload.payment;\n        state.clientSecret = action.payload.clientSecret;\n      })\n      .addCase(createSetupIntent.fulfilled, (state, action) => {\n        state.status = 'idle';\n        state.clientSecret = action.payload.clientSecret;\n      })\n      .addCase(cancelSubscription.fulfilled, (state, action) => {\n        state.status = 'subscriptionCanceled';\n        state.mostRecentPayment = action.payload;\n      })\n  },\n});\n\nexport const getStripe = (state: RootState) => state.stripe;\nexport default StripeSlice.reducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}